  <project xmlns:antcontrib="antlib:net.sf.antcontrib">
    

    <tstamp>
      <format property="cartridgeDate" pattern="yyyy-MM-dd_hh-mm"/>
    </tstamp>

    <property name="imscc.name" value="${courseName}.${cartridgeDate}.imscc"/>
    <property name="imscc.webcontent.dir" value="imscc/webcontent"/>
    <property name="canvas.name" 
	      value="${courseName}.canvas.${cartridgeDate}.imscc"/>
    <property name="canvas.webcontent.dir" value="canvas/web_resources"/>
    <property name="canvas.wiki.dir" value="canvas/wiki_content"/>
    <property name="canvasthin.name" 
	      value="${courseName}.canvasthin.${cartridgeDate}.imscc"/>
    <property name="canvasthin.webcontent.dir" 
	      value="canvasthin/web_resources"/>
    <property name="canvasthin.wiki.dir" value="canvasthin/wiki_content"/>
    <property name="bbthin.name" 
value="${courseName}.bbthin.${cartridgeDate}.zip"/>
    <property name="bbthin.webcontent.dir" value="bbthin/webcontent"/>
    <property name="bb.name" value="${courseName}.bb.${cartridgeDate}.zip"/>
    <property name="bb.webcontent.dir" value="bb/csfiles/home_dir/webcontent"/>

    	
    	    	


    <target name="genIMSCCWebContent" depends="build">
      <echo>building the IMS Course Cartridge ${imscc.name}</echo>
      <delete file="${imscc.name}"/>
      <delete dir="imscc"/>
      <mkdir dir="${imscc.webcontent.dir}"/>
      <copy todir="${imscc.webcontent.dir}">
      		<fileset dir=".">
      	      <include name="Directory/**/*"/>
        	  <include name="graphics/**/*"/>
  	          <include name="Protected/**/*"/>
    	      <include name="Public/**/*"/>
      	      <include name="styles/**/*"/>
      		  <exclude name="epub/**/*"/>
      		  <exclude name="**/*__epub*"/>
      		  <exclude name="**/*~"/>
      		  <exclude name="**/*.md"/>
      		  <exclude name="**/build.xml"/>
      		  <exclude name="**/*.aux"/>
      		  <exclude name="**/*.fdb_latexmk"/>
      		  <exclude name="**/*.fls"/>
      		  <exclude name="**/*.log"/>
      		  <exclude name="**/*.out"/>
      		  <exclude name="**/*.toc"/>
      		  <exclude name="**/*.nav"/>
      		  <exclude name="**/*.snm"/>
      		  <exclude name="**/*.vrb"/>
      		  <exclude name="**/*.tex"/>
      		  <exclude name="**/*.ltx"/>
      		  <exclude name="**/*.4ct"/>
      		  <exclude name="**/*.4tc"/>
      		  <exclude name="**/*.idv"/>
      		  <exclude name="**/*.dvi"/>
      		  <exclude name="**/*.lg"/>
      		  <exclude name="**/*.tmp"/>
      		  <exclude name="**/*.xref"/>
      		</fileset>
      </copy>
     </target>

    <target name="genCanvasWebContent" depends="build" >
      <echo>building the Canvas Course Cartridge ${canvas.name}</echo>
      <delete file="${canvas.name}"/>
      <delete dir="canvas"/>
      <mkdir dir="${canvas.webcontent.dir}"/>
      <copy todir="${canvas.webcontent.dir}">
	<fileset dir=".">
	  <include name="**/*.epub"/>
	  <include name="**/*.mobi"/>
	  <include name="Directory/**/*"/>
	  <include name="graphics/**/*"/>
	  <include name="Protected/**/*"/>
	  <include name="Public/**/*"/>
	  <include name="styles/**/*"/>
	  <exclude name="epub/**/*"/>
	  <exclude name="**/*__epub*"/>
	  <exclude name="**/*~"/>
	  <exclude name="**/*.md"/>
	  <exclude name="**/build.xml"/>
	  <exclude name="**/*.aux"/>
	  <exclude name="**/*.fdb_latexmk"/>
	  <exclude name="**/*.fls"/>
	  <exclude name="**/*.log"/>
	  <exclude name="**/*.out"/>
	  <exclude name="**/*.toc"/>
	  <exclude name="**/*.nav"/>
	  <exclude name="**/*.snm"/>
	  <exclude name="**/*.vrb"/>
	  <exclude name="**/*.tex"/>
	  <exclude name="**/*.ltx"/>
	  <exclude name="**/*.4ct"/>
	  <exclude name="**/*.4tc"/>
	  <exclude name="**/*.idv"/>
	  <exclude name="**/*.dvi"/>
	  <exclude name="**/*.lg"/>
	  <exclude name="**/*.tmp"/>
	  <exclude name="**/*.xref"/>
	</fileset>
      </copy>
      <mkdir dir="${canvas.wiki.dir}"/>
      <copy todir="${canvas.wiki.dir}" flatten="true">
	<fileset dir=".">
	  <include name="Directory/**/*__canvas.html"/>
	  <include name="Protected/**/*__canvas.html"/>
	  <include name="Public/**/*__canvas.html"/>
	</fileset>
      </copy>
     </target>



    <target name="genCanvasThinWebContent" depends="build" >
      <echo>building the Canvas thin Course Cartridge ${canvasthin.name}</echo>
      <delete file="${canvasthin.name}"/>
      <delete dir="canvasthin"/>
      <mkdir dir="${canvasthin.webcontent.dir}"/>
      <mkdir dir="${canvasthin.wiki.dir}"/>
      <copy todir="${canvasthin.wiki.dir}" flatten="true">
	<fileset dir=".">
	  <include name="Directory/**/*__canvas.html"/>
	  <include name="Protected/**/*__canvas.html"/>
	  <include name="Public/**/*__canvas.html"/>
	</fileset>
      </copy>
     </target>




    <target name="genBBthinWebContent" depends="build">
      <echo>building the BlackBoard thin export Cartridge ${bbthin.name}</echo>
      <delete file="${bbthin.name}"/>
      <delete dir="bbthin"/>
      <mkdir dir="${bbthin.webcontent.dir}"/>
      <!--
      <copy todir="${bbthin.webcontent.dir}">
	<fileset dir=".">
	  <include name="**/*.epub"/>
	  <include name="**/*.mobi"/>
	  <include name="Directory/**/*"/>
	  <include name="graphics/**/*"/>
	  <include name="Protected/**/*"/>
	  <include name="Public/**/*"/>
	  <include name="styles/**/*"/>
	  <exclude name="epub/**/*"/>
	  <exclude name="**/*__epub*"/>
	  <exclude name="**/*~"/>
	  <exclude name="**/*.md"/>
	  <exclude name="**/build.xml"/>
	  <exclude name="**/*.aux"/>
	  <exclude name="**/*.fdb_latexmk"/>
	  <exclude name="**/*.fls"/>
	  <exclude name="**/*.log"/>
	  <exclude name="**/*.out"/>
	  <exclude name="**/*.toc"/>
	  <exclude name="**/*.nav"/>
	  <exclude name="**/*.snm"/>
	  <exclude name="**/*.vrb"/>
	  <exclude name="**/*.tex"/>
	  <exclude name="**/*.ltx"/>
	  <exclude name="**/*.4ct"/>
	  <exclude name="**/*.4tc"/>
	  <exclude name="**/*.idv"/>
	  <exclude name="**/*.dvi"/>
	  <exclude name="**/*.lg"/>
	  <exclude name="**/*.tmp"/>
	  <exclude name="**/*.xref"/>
	</fileset>
      </copy>
      -->
     </target>


    <target name="genBBWebContent" depends="build">
      <echo>building the BlackBoard  export Cartridge ${bb.name}</echo>
      <delete file="${bb.name}"/>
      <delete dir="bb"/>
      <mkdir dir="${bb.webcontent.dir}"/>

      <copy todir="${bb.webcontent.dir}">
	<fileset dir=".">
	  <include name="**/*.epub"/>
	  <include name="**/*.mobi"/>
	  <include name="Directory/**/*"/>
	  <include name="graphics/**/*"/>
	  <include name="Protected/**/*"/>
	  <include name="Public/**/*"/>
	  <include name="styles/**/*"/>
	  <exclude name="epub/**/*"/>
	  <exclude name="**/*__epub*"/>
	  <exclude name="**/*~"/>
	  <exclude name="**/*.md"/>
	  <exclude name="**/build.xml"/>
	  <exclude name="**/*.aux"/>
	  <exclude name="**/*.fdb_latexmk"/>
	  <exclude name="**/*.fls"/>
	  <exclude name="**/*.log"/>
	  <exclude name="**/*.out"/>
	  <exclude name="**/*.toc"/>
	  <exclude name="**/*.nav"/>
	  <exclude name="**/*.snm"/>
	  <exclude name="**/*.vrb"/>
	  <exclude name="**/*.tex"/>
	  <exclude name="**/*.ltx"/>
	  <exclude name="**/*.4ct"/>
	  <exclude name="**/*.4tc"/>
	  <exclude name="**/*.idv"/>
	  <exclude name="**/*.dvi"/>
	  <exclude name="**/*.lg"/>
	  <exclude name="**/*.tmp"/>
	  <exclude name="**/*.xref"/>
	</fileset>
      </copy>

     </target>




    <target name="genIMSCCLearningApps" depends="generateDocs" />
        	
    <target name="genCanvasLearningApps" depends="generateDocs" />

    <target name="genCanvasThinLearningApps" depends="generateDocs" />

    <target name="genBBthinLearningApps" depends="generateDocs" />

    <target name="genBBLearningApps" depends="generateDocs" />

    <target name="genIMSCCManifest" 
    	    depends="genIMSCCWebContent,genIMSCCLearningApps"
	    >
         
         <fileset id="imscc.contents.set" dir="${imscc.webcontent.dir}">
   	         <include name="**/*"/>
         </fileset>
         <pathconvert pathsep="${line.separator}" 
   		              property="imscc.contents" 
   		              refid="imscc.contents.set">
   	         <mapper>
   	             <regexpmapper from="${imscc.webcontent.dir}/(.*)" to="\1"/>
   	         </mapper>
         </pathconvert>
         <echo file="imscc.contents" append="false">${imscc.contents}</echo>
         <replaceregexp file="imscc.contents"
   		     flags="m"
   		     byline="true"
   		     match="^"
   		     replace="&lt;file&gt;"/>
         <replaceregexp file="imscc.contents"
   		     flags="m"
   		     byline="true"
   		     match="$"
   		     replace="&lt;/file&gt;"/>
         <echo file="imscc.contents.xml">&lt;imscc&gt;
         &lt;sem&gt;${sem}&lt;/sem&gt;
         &lt;title&gt;${courseTitle}: ${semester}&lt;/title&gt;
         &lt;author&gt;${courseName}&lt;/author&gt;
         &lt;courseName&gt;${courseName}&lt;/courseName&gt;
         &lt;files&gt;
         </echo>
         <concat destfile="imscc.contents.xml" append="yes">
   	         <filelist dir="." files="imscc.contents"/> 
         </concat>
         <echo file="imscc.contents.xml" append="true">&lt;/files&gt;
    	    &lt;!--
    	 </echo>
    	 <concat destfile="imscc.contents.xml" append="true">
    	    <fileset dir="Directory/outline" includes="outline.xml"/>
    	 </concat>
    	 <concat destfile="imscc.contents.xml" append="true">
    	    <fileset dir="Directory/outline" includes="titleTable.xml"/>
    	 </concat>
    	 <replace file="imscc.contents.xml" 
    	          token="&lt;outline&gt;" 
    	          value="--&gt; &lt;outline&gt;"/>
         <echo file="imscc.contents.xml" append="true">&lt;/imscc&gt;</echo>
         
         <xslt in="imscc.contents.xml"
   	           out="imscc/imsmanifest.xml"
   	           style="templates/imsccManifest.xsl"
   	           >
   	         <classpath location="templates/saxon.jar" />
   	         <param name="doc" expression="imscc"/>
   	         <param name="baseURL" expression="${baseurl}"/>
         </xslt>
         
         
    </target>
    	
    <target name="genCanvasManifest" 
    	    depends="genCanvasWebContent,genCanvasLearningApps"
	    >
         
         <fileset id="canvas.contents.set" dir="${canvas.webcontent.dir}">
   	         <include name="**/*"/>
         </fileset>
         <pathconvert pathsep="${line.separator}" 
   		              property="canvas.contents" 
   		              refid="canvas.contents.set">
   	         <mapper>
   	             <regexpmapper from="${canvas.webcontent.dir}/(.*)" to="\1"/>
   	         </mapper>
         </pathconvert>
         <echo file="canvas.contents" append="false">${canvas.contents}</echo>
         <replaceregexp file="canvas.contents"
   		     flags="m"
   		     byline="true"
   		     match="^"
   		     replace="&lt;file&gt;"/>
         <replaceregexp file="canvas.contents"
   		     flags="m"
   		     byline="true"
   		     match="$"
   		     replace="&lt;/file&gt;"/>
         <echo file="canvas.contents.xml">&lt;imscc&gt;
         &lt;sem&gt;${sem}&lt;/sem&gt;
         &lt;title&gt;${courseTitle}: ${semester}&lt;/title&gt;
         &lt;author&gt;${courseName}&lt;/author&gt;
         &lt;courseName&gt;${courseName}&lt;/courseName&gt;
         &lt;files&gt;
         </echo>
         <concat destfile="canvas.contents.xml" append="yes">
   	         <filelist dir="." files="canvas.contents"/> 
         </concat>
         <echo file="canvas.contents.xml" append="true">&lt;/files&gt;
    	    &lt;!--
    	 </echo>
    	 <concat destfile="canvas.contents.xml" append="true">
    	    <fileset dir="Directory/outline" includes="outline.xml"/>
    	 </concat>
    	 <concat destfile="canvas.contents.xml" append="true">
    	    <fileset dir="Directory/outline" includes="titleTable.xml"/>
    	 </concat>
    	 <replace file="canvas.contents.xml" 
    	          token="&lt;outline&gt;" 
    	          value="--&gt; &lt;outline&gt;"/>
         <echo file="canvas.contents.xml" append="true">&lt;/imscc&gt;</echo>
         
         <xslt in="canvas.contents.xml"
   	           out="canvas/imsmanifest.xml"
   	           style="templates/canvasManifest.xsl"
   	           >
   	         <classpath location="templates/saxon.jar" />
   	         <param name="doc" expression="canvas"/>
   	         <param name="baseURL" expression="${baseurl}"/>
         </xslt>
         
         
    </target>


    <target name="genCanvasThinManifest" 
    	    depends="genCanvasThinWebContent,genCanvasThinLearningApps"
	    >
         
         <fileset id="canvasthin.contents.set" 
		  dir="${canvasthin.webcontent.dir}">
   	         <include name="**/*"/>
         </fileset>
         <pathconvert pathsep="${line.separator}" 
   		              property="canvasthin.contents" 
   		              refid="canvasthin.contents.set">
   	         <mapper>
   	             <regexpmapper from="${canvasthin.webcontent.dir}/(.*)" 
				   to="\1"/>
   	         </mapper>
         </pathconvert>
         <echo file="canvasthin.contents" 
	       append="false">${canvasthin.contents}</echo>
         <replaceregexp file="canvasthin.contents"
   		     flags="m"
   		     byline="true"
   		     match="^"
   		     replace="&lt;file&gt;"/>
         <replaceregexp file="canvasthin.contents"
   		     flags="m"
   		     byline="true"
   		     match="$"
   		     replace="&lt;/file&gt;"/>
         <echo file="canvasthin.contents.xml">&lt;imscc&gt;
         &lt;sem&gt;${sem}&lt;/sem&gt;
         &lt;title&gt;${courseTitle}: ${semester}&lt;/title&gt;
         &lt;author&gt;${courseName}&lt;/author&gt;
         &lt;courseName&gt;${courseName}&lt;/courseName&gt;
         &lt;files&gt;
         </echo>
	 <!--
         <concat destfile="canvasthin.contents.xml" append="yes">
   	         <filelist dir="." files="canvasthin.contents"/> 
         </concat>
	 -->
         <echo file="canvasthin.contents.xml" append="true">&lt;/files&gt;
    	    &lt;!--
    	 </echo>
    	 <concat destfile="canvasthin.contents.xml" append="true">
    	    <fileset dir="Directory/outline" includes="outline.xml"/>
    	 </concat>
    	 <concat destfile="canvasthin.contents.xml" append="true">
    	    <fileset dir="Directory/outline" includes="titleTable.xml"/>
    	 </concat>
    	 <replace file="canvasthin.contents.xml" 
    	          token="&lt;outline&gt;" 
    	          value="--&gt; &lt;outline&gt;"/>
         <echo file="canvasthin.contents.xml" 
	       append="true">&lt;/imscc&gt;</echo>
         
         <xslt in="canvasthin.contents.xml"
   	           out="canvasthin/imsmanifest.xml"
   	           style="templates/canvasthinManifest.xsl"
   	           >
   	         <classpath location="templates/saxon.jar" />
   	         <param name="doc" expression="canvasthin"/>
   	         <param name="baseURL" expression="${baseurl}"/>
         </xslt>
         
         
    </target>



    <target name="genBBthinManifest" 
    	    depends="genBBthinWebContent,genBBthinLearningApps">
         
         <fileset id="bbthin.contents.set" dir="${bbthin.webcontent.dir}">
   	         <include name="**/*"/>
         </fileset>
         <pathconvert pathsep="${line.separator}" 
   		              property="bbthin.contents" 
   		              refid="bbthin.contents.set">
   	         <mapper>
   	             <regexpmapper from="${bbthin.webcontent.dir}/(.*)" to="\1"/>
   	         </mapper>
         </pathconvert>
         <echo file="bbthin.contents" append="false">${bbthin.contents}</echo>
         <replaceregexp file="bbthin.contents"
   		     flags="m"
   		     byline="true"
   		     match="^"
   		     replace="&lt;file&gt;"/>
         <replaceregexp file="bbthin.contents"
   		     flags="m"
   		     byline="true"
   		     match="$"
   		     replace="&lt;/file&gt;"/>
         <echo file="bbthin.contents.xml">&lt;imscc&gt;
         &lt;sem&gt;${sem}&lt;/sem&gt;
         &lt;title&gt;${courseTitle}: ${semester}&lt;/title&gt;
         &lt;author&gt;${courseName}&lt;/author&gt;
         &lt;courseName&gt;${courseName}&lt;/courseName&gt;
         &lt;files&gt;
         </echo>
	 <!--
         <concat destfile="bbthin.contents.xml" append="yes">
   	         <filelist dir="." files="bbthin.contents"/> 
         </concat>
	 -->
         <echo file="bbthin.contents.xml" append="true">&lt;/files&gt;
    	    &lt;!--
    	 </echo>
    	 <concat destfile="bbthin.contents.xml" append="true">
    	    <fileset dir="Directory/outline" includes="outline.xml"/>
    	 </concat>
    	 <concat destfile="bbthin.contents.xml" append="true">
    	    <fileset dir="Directory/outline" includes="titleTable.xml"/>
    	 </concat>
    	 <replace file="bbthin.contents.xml" 
    	          token="&lt;outline&gt;" 
    	          value="--&gt; &lt;outline&gt;"/>
         <echo file="bbthin.contents.xml" append="true">&lt;/imscc&gt;</echo>
         
         <xslt in="bbthin.contents.xml"
   	           out="bbthin/imsmanifest.xml"
   	           style="templates/bbthinManifest.xsl"
   	           >
   	         <classpath location="templates/saxon.jar" />
   	         <param name="doc" expression="bbthin"/>
   	         <param name="baseURL" expression="${baseurl}"/>
         </xslt>
         
         
    </target>



    <target name="genBBManifest" 
    	    depends="genBBWebContent,genBBLearningApps">
         
         <fileset id="bb.contents.set" dir="${bb.webcontent.dir}">
   	         <include name="**/*"/>
         </fileset>
         <pathconvert pathsep="${line.separator}" 
   		              property="bb.contents" 
   		              refid="bb.contents.set">
   	         <mapper>
   	             <regexpmapper from="${bb.webcontent.dir}/(.*)" to="\1"/>
   	         </mapper>
         </pathconvert>
         <echo file="bb.contents" append="false">${bb.contents}</echo>
         <replaceregexp file="bb.contents"
   		     flags="m"
   		     byline="true"
   		     match="^"
   		     replace="&lt;file&gt;"/>
         <replaceregexp file="bb.contents"
   		     flags="m"
   		     byline="true"
   		     match="$"
   		     replace="&lt;/file&gt;"/>
         <echo file="bb.contents.xml">&lt;imscc&gt;
         &lt;sem&gt;${sem}&lt;/sem&gt;
         &lt;title&gt;${courseTitle}: ${semester}&lt;/title&gt;
         &lt;author&gt;${courseName}&lt;/author&gt;
         &lt;courseName&gt;${courseName}&lt;/courseName&gt;
         &lt;files&gt;
         </echo>
         <concat destfile="bb.contents.xml" append="yes">
   	         <filelist dir="." files="bb.contents"/> 
         </concat>
         <echo file="bb.contents.xml" append="true">&lt;/files&gt;
    	    &lt;!--
    	 </echo>
    	 <concat destfile="bb.contents.xml" append="true">
    	    <fileset dir="Directory/outline" includes="outline.xml"/>
    	 </concat>
    	 <concat destfile="bb.contents.xml" append="true">
    	    <fileset dir="Directory/outline" includes="titleTable.xml"/>
    	 </concat>
    	 <replace file="bb.contents.xml" 
    	          token="&lt;outline&gt;" 
    	          value="--&gt; &lt;outline&gt;"/>
         <echo file="bb.contents.xml" append="true">&lt;/imscc&gt;</echo>
         
         <xslt in="bb.contents.xml"
   	           out="bb/imsmanifest.xml"
   	           style="templates/bbManifest.xsl"
   	           >
   	         <classpath location="templates/saxon.jar" />
   	         <param name="doc" expression="bb"/>
   	         <param name="baseURL" expression="${baseurl}"/>
         </xslt>
         
         
    </target>


    <target name="generateIMSCCFiles" depends="genIMSCCManifest">
        <delete file="${imscc.name}"/>
    	<zip destfile="${imscc.name}"
    		 basedir="imscc"/>
    </target>            

    <target name="generateCanvasFiles" depends="genCanvasManifest">
        <delete file="${canvas.name}"/>
    	<zip destfile="${canvas.name}"
    		 basedir="canvas"/>
    </target>            


    <target name="generateCanvasThinFiles" depends="genCanvasThinManifest">

        <delete file="${canvasthin.name}"/>
    	<zip destfile="${canvasthin.name}"
    		 basedir="canvasthin"/>
    </target>            

    <target name="generateBBthinFiles" depends="genBBthinManifest">
        <delete file="${bbthin.name}"/>
    	<zip destfile="${bbthin.name}"
    		 basedir="bbthin"/>
    </target>            

    <target name="generateBBFiles" depends="genBBManifest">
        <delete file="${bb.name}"/>
    	<zip destfile="${bb.name}"
    		 basedir="bb"/>
    </target>            

    <!-- Uncomment the next line to suppress deletion of intermediate files. -->
    <!--  <property name="debugIMSCC" value="1"/>  -->


    <target name="cleanIMSCC" depends="generateIMSCCFiles"
	    unless="debugIMSCC">
        <delete file="imscc.contents"/>
        <delete file="imscc.contents.xml"/>
        <delete dir="imscc"/>
    </target>            

    <target name="cleanCanvas" depends="generateCanvasFiles"
	    unless="debugIMSCC">
        <delete file="canvas.contents"/>
        <delete file="canvas.contents.xml"/>
        <delete dir="canvas"/>
    </target>            


    <target name="cleanCanvasThin" depends="generateCanvasThinFiles"
	    unless="debugIMSCC">
        <delete file="canvasthin.contents"/>
        <delete file="canvasthin.contents.xml"/>
        <delete dir="canvasthin"/>
    </target>            

    <target name="cleanBBthin" depends="generateBBthinFiles"
	    unless="debugIMSCC">
        <delete file="bbthin.contents"/>
        <delete file="bbthin.contents.xml"/>
        <delete dir="bbthin"/>
    </target>            

    <target name="cleanBB" depends="generateBBFiles"
	    unless="debugIMSCC">
        <delete file="bb.contents"/>
        <delete file="bb.contents.xml"/>
        <delete dir="bb"/>
    </target>            


    <target name="generateIMSCC" depends="cleanIMSCC">
    </target>            

    <target name="generateCanvas" depends="cleanCanvas">
    </target>            


    <target name="generateCanvasThin" depends="cleanCanvasThin">
    </target>            

    <target name="generateBBthin" depends="cleanBBthin">
    </target>            

    <target name="generateBB" depends="cleanBB">
    </target>            




</project>